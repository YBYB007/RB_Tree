# 红黑树

红黑树是一种自平衡的二叉查找树，它通过确保任何节点从根到叶子的最长路径不会超过最短路径的两倍，来维持操作的高效性。红黑树能够保证查找、插入和删除操作的时间复杂度为 log(n)。红黑树的高度最高为2log(n+1)。	





## 性质

红黑树是一位身穿两种颜色战袍的优雅舞者，它在数据的森林中跳着一支精心编排的舞蹈，这支舞蹈遵循几个神奇的规则，以确保舞步的和谐与平衡：

1、**根始终为黑**：舞蹈的领舞者，它代表了尊严和权威。

2、**红不连红**：没有两个红衣舞者会手牵手跳舞，这是为了避免舞池中出现一条长长的红色链条，这样会破坏舞蹈的美感和平衡。

3、**黑相同数**：无论观众从哪个方向看，从该节点到叶子的每条路径上，黑衣舞者的数量都是相同的。这确保了所有观众都能享受到同样精彩的舞蹈。

4、**新来者红衣**：每当一位新的舞者加入这场舞蹈，他总是先穿上红色的战袍，以显示他的活力和激情。

5、**自我平衡术**：当红黑树的舞蹈因为新舞者的加入或旧舞者的离开而失去平衡时，它会自动进行一系列旋转和颜色变换的调整，恢复其优雅的队形。





## 节点

1. **颜色属性**：每个节点都有一个颜色属性，可以是红色或黑色。这个属性是红黑树保持平衡的关键。
2. **数据域**：存储节点的数据，可以是任意的数据类型，但在二叉查找树中，通常是可以进行比较操作的数据。
3. **左右子节点指针**：每个节点包含两个指针，分别指向其左子节点和右子节点。左子节点存储小于当前节点的数据，右子节点存储大于当前节点的数据。





## 平衡

### 插入（红色修正）

1. 将红黑树当成一个二叉查找树，插入数据，着色为红。
2. 判断插入节点是否与父节点同为红色，如果都是红色就需要进行双红颜色修正。
3. 双红修正：是一个从底向上的循环过程，最后使红黑树达到平衡。
   1. 当前节点点与父节点都是红色，且父节点的兄弟节点存在并且也是红色的，是黑红红的情况，需要调整为红黑红。将祖父成为当前节点，如果当前结点变成根结点，那么直接将根结点染成黑色（这是层数增加的唯一情况），调整结束。如果当前结点的父节点是红色，那么需要继续调整， 否则调整结束。
   2. 当前节点与父节点都是红色，且父节点的兄弟节点为黑色或者不存在，父节点是左孩子。如果当前节点是左孩子，将当前节点的父节点染黑，祖父结点染红，判断LL,LR,RL,RR四种旋转情况。


### 删除（黑色修正）

1. 删除的是叶子节点。如果删除的红节点，结束。如果删除的是黑节点，这是最为复杂的一种情况，因为这条路上已经没有可以补充的黑节点，需要改变其他路的黑节点数量。
   1. 如果是根节点，删除结束。
   2. 如果它的兄弟是黑色，且至少有一个红色孩子，就可以从兄弟树上拿一个节点补过来。
      1. 如果它左孩子是红色，让孩子结点染成父节点的颜色，父节点染成祖父节点的颜色，LL旋转调节，就调整好了（RR类似）。
      2. 如果它的右孩子是红色，那么直接将其染成祖父的颜色，祖父变黑，然后LR旋转，需要先旋转祖父节点的左孩子，然后再旋转祖父节点，就调整好了（RL类似）。
   3. 如果兄弟是黑色而且孩子都是黑色或者没有孩子， 直接将兄弟染红，消除一个黑节点，将结点上移为父节点，从更大的树上调整父节点。
      1. 如果父节点是红色，那么直接变为黑色就修复好了。
      2. 如果父节点是黑色，那么还需要继续看他的兄弟节点。
      3. 如果是根结点，并不会破坏黑路同性质，就调整好了。 
   4. 如果它的兄弟是红色，直接将兄弟和父节点颜色交换，朝黑叶子节点旋转，得到新的兄弟节点，然后继续看他的兄弟节点。
2. 如果只有左孩子或者右孩子，直接代替即可。颜色修正，这种情况只能是一黑一红，不可能是其他情况，也就是说红色节点不可能只有左子树或者右子树，而且红色节点是叶子节点，不然就违反了红黑树的性质。删除这个黑结点，让孩子替换过来，这时候这条路径会少一个黑节点，将代替过来的红结点染黑就可以了。
3. 如果都有，那么就它的直接前驱或者直接后继（不能打破红黑树的有序性，所以要用直接前驱或直接后继）替换它，继续判断，最终转化为1或2的情况。







## 等价

去掉红色结点后，将黑色结点连接到异地，所有的叶子结点都在同一层，会形成一颗二三四树。

